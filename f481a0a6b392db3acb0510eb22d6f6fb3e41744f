{
  "comments": [
    {
      "key": {
        "uuid": "438cf20d_44a4163d",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 10,
      "author": {
        "id": 1080813
      },
      "writtenOn": "2019-10-03T06:54:20Z",
      "side": 1,
      "message": "is it possible that they\u0027re using top-level vbmeta in boot?",
      "range": {
        "startLine": 10,
        "startChar": 51,
        "endLine": 10,
        "endChar": 67
      },
      "revId": "f481a0a6b392db3acb0510eb22d6f6fb3e41744f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b06ff499_dae96015",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 10,
      "author": {
        "id": 1080813
      },
      "writtenOn": "2019-10-03T06:54:20Z",
      "side": 1,
      "message": "if there is \u0027avb\u0027 in fstab, does the mount / verity works when we fallback to VbootV1?",
      "range": {
        "startLine": 10,
        "startChar": 0,
        "endLine": 10,
        "endChar": 3
      },
      "revId": "f481a0a6b392db3acb0510eb22d6f6fb3e41744f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7438efa6_3d37a323",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 10,
      "author": {
        "id": 1211949
      },
      "writtenOn": "2019-10-03T21:39:38Z",
      "side": 1,
      "message": "Well thanks for making me look, turns out I was wrong.\nSure there is no vbmeta partition, but there is a vbmeta_a partition. (even though the device doesn\u0027t have an A/B partition scheme).\n\nBootloader passes androidboot.slot_suffix\u003d_a, so i don\u0027t understand why init took vbmeta not vbmeta_a, I\u0027ll need to dig deeper.\n\nHowever they are using custom logics:\n- kernel/bootloader accepts to boot an unsigned GSI without changing vbmeta.img\n- even though it\u0027s a system-as-root system, bootloader doesn\u0027t seem to pass dm-verity root hash/dm-linear fallback on cmdline\nSo I don\u0027t know if there vbmeta is compatible with AOSP\u0027s\n\nI\u0027m putting this commit as WIP until I have cleared this up.\n\nThanks",
      "parentUuid": "438cf20d_44a4163d",
      "range": {
        "startLine": 10,
        "startChar": 51,
        "endLine": 10,
        "endChar": 67
      },
      "revId": "f481a0a6b392db3acb0510eb22d6f6fb3e41744f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8726fe31_4283023c",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 10,
      "author": {
        "id": 1080813
      },
      "writtenOn": "2019-10-04T07:14:46Z",
      "side": 1,
      "message": "\u003e so i don\u0027t understand why init took vbmeta not vbmeta_a\n\nYup, this is wield. init/fs_mgr should invoke libavb-\u003eavb_slot_verify() with androidboot.slot_suffix\u003d_a.\n\nhttps://android-review.googlesource.com/c/platform/system/core/+/1120403/2/fs_mgr/libfs_avb/fs_avb.cpp#354\n\n\n\u003e even though it\u0027s a system-as-root system, bootloader doesn\u0027t seem to pass dm-verity root hash/dm-linear fallback on cmdline\n\nOr is vbmeta flag set to 2 in you case?\nhttps://android.googlesource.com/platform/external/avb/+/refs/heads/master/libavb/avb_vbmeta_image.h#59",
      "parentUuid": "7438efa6_3d37a323",
      "range": {
        "startLine": 10,
        "startChar": 51,
        "endLine": 10,
        "endChar": 67
      },
      "revId": "f481a0a6b392db3acb0510eb22d6f6fb3e41744f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7ed14e36_d8f8948e",
        "filename": "init/first_stage_mount.cpp",
        "patchSetId": 2
      },
      "lineNbr": 836,
      "author": {
        "id": 1080813
      },
      "writtenOn": "2019-10-03T06:54:20Z",
      "side": 1,
      "message": "How about:\n\n// Fallbacks to VBootV1 if VBootV2 fails.\nif (IsDtVbmetaCompatible(fstab) \u0026\u0026 !handle-\u003eDoFirstStageMount()) {\n  ...\n}",
      "range": {
        "startLine": 836,
        "startChar": 7,
        "endLine": 836,
        "endChar": 35
      },
      "revId": "f481a0a6b392db3acb0510eb22d6f6fb3e41744f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d16fa026_f6965e98",
        "filename": "init/first_stage_mount.cpp",
        "patchSetId": 2
      },
      "lineNbr": 838,
      "author": {
        "id": 1080813
      },
      "writtenOn": "2019-10-03T06:54:20Z",
      "side": 1,
      "message": "Let\u0027s using spaces instead.",
      "range": {
        "startLine": 838,
        "startChar": 0,
        "endLine": 838,
        "endChar": 5
      },
      "revId": "f481a0a6b392db3acb0510eb22d6f6fb3e41744f",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    }
  ]
}